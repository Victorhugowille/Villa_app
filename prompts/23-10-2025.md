# Prompt: Arquitetura do Bot de WhatsApp

**Data:** 23/10/2025
**Contexto:** In√≠cio do desenvolvimento de uma funcionalidade para automatizar avisos via WhatsApp usando Supabase.

## üó£Ô∏è Prompt do Usu√°rio
"Quero integrar um Bot de WhatsApp no meu restaurante para avisar quando o pedido saiu para entrega.
Estou usando Supabase. Devo fazer isso no c√≥digo Flutter ou no Banco de Dados?
Crie a estrutura do `BotProvider` para lidar com isso."

## ü§ñ Resposta (Estrutura H√≠brida)

Recomendo usar **Supabase Edge Functions** para o envio real (seguran√ßa) e o Flutter apenas para o gatilho.

### C√≥digo: `lib/providers/bot_provider.dart`

```dart
class BotProvider with ChangeNotifier {
  final SupabaseClient _supabase = Supabase.instance.client;

  // Fun√ß√£o chamada quando o motoboy sai com o pedido
  Future<void> notificarCliente(String pedidoId, String telefone) async {
    try {
      // Invoca a Edge Function que conecta com a API do WhatsApp (ex: Z-API)
      await _supabase.functions.invoke('whatsapp-notification', body: {
        'phone': telefone,
        'order_id': pedidoId,
        'status': 'out_for_delivery'
      });
    } catch (e) {
      debugPrint('Erro ao enviar notifica√ß√£o: $e');
    }
  }
}